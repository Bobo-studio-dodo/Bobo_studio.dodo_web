<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è¨‚å–® | Bobo_studio.dodo</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- é¢¨æ ¼è¨­å®š --- */
        :root {
            --text-primary: #8a5a6a; --text-secondary: #b38996;
            --accent-pink: #ff9eb5; --accent-hover: #ff7a96;
            --bg-main: #fffafc; --bg-card: #ffffff;
            --status-pending: #f39c12; --status-shipping: #3498db; --status-done: #2ecc71;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans TC', sans-serif; margin: 0; background-color: var(--bg-main); color: var(--text-primary); }
        
        header { background: rgba(255, 255, 255, 0.9); padding: 0.8rem 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ffe3ec; position: sticky; top: 0; z-index: 10; }
        .logo-text { font-weight: bold; font-size: 1.2rem; color: var(--text-primary); }
        
        .container { max-width: 800px; margin: 2rem auto; padding: 0 1.5rem 4rem 1.5rem; }
        
        /* è¿”å›æŒ‰éˆ•æ¨£å¼ */
        .btn-back { background-color: #eee; color: #666; border: none; padding: 8px 15px; border-radius: 50px; cursor: pointer; font-size: 0.9rem; transition: 0.3s; }
        .btn-back:hover { background-color: #ddd; }

        /* è¨‚å–®å¡ç‰‡æ¨£å¼ */
        .order-card { 
            background: var(--bg-card); border-radius: 15px; padding: 20px; 
            box-shadow: 0 5px 15px rgba(255, 158, 181, 0.1); 
            border: 1px solid #ffe3ec; margin-bottom: 20px; transition: 0.3s;
        }
        .order-card:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(255, 158, 181, 0.2); }

        .order-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px dashed #eee; padding-bottom: 10px; margin-bottom: 10px; }
        .order-id { font-weight: bold; color: var(--text-secondary); font-size: 0.9rem; }
        .order-date { font-size: 0.85rem; color: #999; }

        .order-body { display: flex; justify-content: space-between; align-items: center; }
        .order-info { flex: 1; }
        .order-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; color: #555; }
        .order-price { color: var(--text-primary); font-weight: bold; font-size: 1.2rem; }
        
        .status-badge { padding: 5px 12px; border-radius: 20px; color: white; font-size: 0.85rem; font-weight: bold; }
        .st-pending { background-color: var(--status-pending); }
        .st-shipping { background-color: var(--status-shipping); }
        .st-done { background-color: var(--status-done); }
    </style>
</head>
<body>

    <header>
        <div class="logo-text">æˆ‘çš„è¨‚å–®è¨˜éŒ„</div>
        <button class="btn-back" onclick="location.href='index.html'">â¬… å›å¤§å»³</button>
    </header>

    <div class="container">
        <div id="loadingOverlay" style="text-align:center; padding: 50px;">
            <h3>ğŸ”„ è®€å–è¨‚å–®ä¸­...</h3>
        </div>
        
        <div id="orderList" style="display:none;">
            </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // âœ… æ‚¨çš„ Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCE95n9P7oeUMDo_LGffDt9H8pGtpmUOFw",
            authDomain: "my-shop-2026-1b573.firebaseapp.com",
            projectId: "my-shop-2026-1b573",
            storageBucket: "my-shop-2026-1b573.firebasestorage.app",
            messagingSenderId: "15775390058",
            appId: "1:15775390058:web:ef08a6b8bca2657ecbed13"
        };
        
        // âœ… æ‚¨çš„ GAS å¾Œç«¯ç¶²å€
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzVo9_FACAbkJnnIIXTXu4g4pgCSPKrx9q90Ywd1_rlbXsbmmAmnAprbAbfnB-akdLhtA/exec";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // ç›£è½ç™»å…¥ç‹€æ…‹
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // å·²ç™»å…¥ -> å‘¼å«å¾Œç«¯æŠ“å–çœŸå¯¦è¨‚å–®
                try {
                    const res = await fetch(GAS_URL, {
                        method: "POST",
                        body: JSON.stringify({ action: "get_orders", email: user.email })
                    });
                    const json = await res.json();
                    
                    // éš±è—è®€å–åœˆåœˆï¼Œé¡¯ç¤ºè¨‚å–®åˆ—è¡¨
                    document.getElementById('loadingOverlay').style.display = 'none';
                    document.getElementById('orderList').style.display = 'block';
                    
                    // æŠŠè³‡æ–™ç•«åœ¨ç•«é¢ä¸Š
                    renderOrders(json.data); 

                } catch (e) {
                    alert("è¨‚å–®è®€å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
                    document.getElementById('loadingOverlay').style.display = 'none';
                }
            } else {
                // æœªç™»å…¥ -> è¸¢å›é¦–é 
                alert("è«‹å…ˆç™»å…¥ï¼");
                window.location.href = "index.html";
            }
        });

        // --- å°‡è¨‚å–®è³‡æ–™è½‰ç‚º HTML å¡ç‰‡ ---
        function renderOrders(orders) {
            const list = document.getElementById('orderList');
            
            // å¦‚æœå¾Œç«¯å›å‚³ç©ºé™£åˆ—ï¼Œé¡¯ç¤ºã€Œå°šç„¡è¨‚å–®ã€
            if (!orders || orders.length === 0) {
                list.innerHTML = '<div style="text-align:center; padding:50px; color:#ccc;"><h3>ğŸ“­ ç›®å‰æ²’æœ‰è¨‚å–®è¨˜éŒ„</h3></div>';
                return;
            }

            let html = "";
            orders.forEach(order => {
                // æ ¹æ“šç‹€æ…‹æ–‡å­—æ±ºå®šé¡è‰² class
                let stClass = "st-pending"; // é è¨­é»ƒè‰² (è™•ç†ä¸­)
                
                // å¦‚æœç‹€æ…‹æ–‡å­—åŒ…å«ã€Œé…é€ã€ï¼Œè®Šè—è‰²
                if (order.status && order.status.includes("é…é€")) stClass = "st-shipping";
                
                // å¦‚æœç‹€æ…‹æ–‡å­—åŒ…å«ã€Œå®Œæˆã€ï¼Œè®Šç¶ è‰²
                if (order.status && order.status.includes("å®Œæˆ")) stClass = "st-done";

                html += `
                <div class="order-card">
                    <div class="order-header">
                        <span class="order-id">#${order.id}</span>
                        <span class="order-date">${order.date}</span>
                    </div>
                    <div class="order-body">
                        <div class="order-info">
                            <div class="order-title">${order.title}</div>
                            <div class="order-price">NT$ ${order.price}</div>
                        </div>
                        <div class="order-status">
                            <span class="status-badge ${stClass}">${order.status}</span>
                        </div>
                    </div>
                </div>
                `;
            });
            list.innerHTML = html;
        }
    </script>
</body>
</html>